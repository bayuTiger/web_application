# メモ

- WEBサーバー = HTTPを喋るデーモンプログラム
- データとしては正しいものを渡せているのに意図した挙動をしてくれない場合は**読み込みフォーマット**が問題
  - 例えばCSSが適用されないときに、レスポンスヘッダを見てみると`Content-Type: text/html`となっている
  - これはcssファイルの中身がcssではなくhtmlとして読み込まれてしまっている状態
  - 画像ファイルについては、Chromeの天才的な判断によって、自動で別ファイルだと認識してくれる
- サーバーを再起動するタイミングがわからない...
  - **サーバーのソースコードを変更**したとき
  - リクエストを受けたときに毎回読み込み直すファイルの変更は、リクエストが来たときに毎回読み込まれるという性質上、必要ない

## HTTP

- Webサービスとブラウザがやりとりするための規約
  - リクエスト
    - 1行目：リクエストライン
    - 2行目~空行：リクエストヘッダー
    - 空行~：リクエストボディ
  - レスポンス
    - 1行目：ステータスライン
    - 2行目~空行：レスポンスヘッダー
    - 空行~：レスポンスボディ

- HTTPヘッダーのうち、必須なのは**リクエストにおける`Host`**

- どうやって送るか -> トランスポート層
- 何を送るか -> アプリケーション層

### レスポンスヘッダー

- `Date: Wed, 28 Oct 2020 07:57:45 GMT`
  - レスポンスを作成した日時
- `Server: Apache/2.4.41 (Unix)`
  - レスポンスを作成したプログラムに関する情報
  - あんまり細かいことは書かない
    - サーバー名やOSに留める
- `Content-Location: index.html.en`
  - 返却されたレスポンスを取得するための、**代わりのURLを示す**
  - コンテントネゴシエーションを行う
    - リクエストAcceptヘッダーの内容に応じて、適切なレスポンスを作成すること
- `Vary: negotiate`
  - ブラウザや中間サーバーがキャッシュを使用するかどうかを制御する
  - このヘッダーに記載されたヘッダーが変化しない限りは、キャッシュを使って良いということを意味する
- `TCN: choice`
  - Transparent Content Negotiation
  - どのようにコンテントネゴシエーションが行われたかを伝える
- `Last-Modified: Thu, 29 Aug 2019 05:05:59 GMT`
  - コンテンツの内容が最後に変更された日時を返す
- `ETag: "2d-5913a76187bc0"`
  - Vary同様、ブラウザや中間サーバーがキャッシュを使用するかどうかを制御する
  - レスポンスを生成するリソースの特定のバージョンを示す
    - 多くの場合、ファイルやコンテンツのハッシュ値が使われる
- `Accept-Ranges: bytes`
  - リソースの部分的なリクエストに対応していることを示す
- `Content-Length: 45`
  - レスポンスボディのバイト数を10進数で返す
- `Keep-Alive: timeout=5, max=100`
  - コネクションの再利用に関して、いつまでコネクションを再利用して良いのかの情報を返す
- `Connection: Keep-Alive`
  - 一度確立したTCPコネクションを次のリクエストで再利用して良いかどうかを返す
  - TCPコネクションは確立するのにそれなりに時間がかかり、表示速度を最適化する際にはTCPコネクションの再利用が効果的
  - コネクションの再利用に対応していないサーバーは`Connection: close`を返す
- `Content-Type: text/html`
  - レスポンスボディの型式を返す
  - 使える値は**MIME-Type**